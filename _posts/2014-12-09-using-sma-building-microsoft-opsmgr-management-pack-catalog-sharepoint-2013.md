---
id: 3473
title: Using SMA to Building Your Own Microsoft OpsMgr Management Pack Catalog On SharePoint 2013
date: 2014-12-09T11:04:48+10:00
author: Tao Yang
layout: post
guid: http://blog.tyang.org/?p=3473
permalink: /2014/12/09/using-sma-building-microsoft-opsmgr-management-pack-catalog-sharepoint-2013/
categories:
  - SCOM
  - SMA
tags:
  - SCOM
  - SMA
---
<h4>Background</h4>
Over the years that I’ve been working with OpsMgr, for me, the Microsoft Pinpoint MP Catalog was a one stop shop for getting Microsoft management packs. More information about the Pinpoint MP Catalog can be found in Marnix’s post: <a href="http://thoughtsonopsmgr.blogspot.com.au/2010/07/pinpoint-management-pack-catalog.html">http://thoughtsonopsmgr.blogspot.com.au/2010/07/pinpoint-management-pack-catalog.html</a>

Based on the information came out in TechEd Europe 2014, looks like there will be changes introduced to the System Center Pinpoint site (<a href="http://channel9.msdn.com/Events/TechEd/Europe/2014/Ch9-34">http://channel9.msdn.com/Events/TechEd/Europe/2014/Ch9-34</a>, from 09:00 onwards). And it seems the link from Marnix’s post <a href="https://pinpoint.microsoft.com/systemcenter">https://pinpoint.microsoft.com/systemcenter</a> is no longer valid.

So I’ve decided to do some experiment, see if I can generate and maintain a Microsoft MP catalog on-premise, for myself – Something I’ve always wanted. It took me couple of days, and I managed to build a MP catalog on a SharePoint 2013 site using PowerShell, SMA, and some existing scripts from the System Center community. The End result looks like this:

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML765cc0bc.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="SNAGHTML765cc0bc" src="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML765cc0bc_thumb.png" alt="SNAGHTML765cc0bc" width="773" height="465" border="0" /></a>

Currently, this catalog contains 1404 entries, and it is generated by 2 SMA runbooks that I have developed. In this post, I will go through the steps I took to setup this solution.
<h4>01. Creating a SharePoint 2013 List</h4>
Firstly, I created a list on my SharePoint 2013 site and called it “<strong>MP Catalog</strong>”:
<a href="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML7607e74d.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="SNAGHTML7607e74d" src="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML7607e74d_thumb.png" alt="SNAGHTML7607e74d" width="399" height="336" border="0" /></a>

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image3.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb3.png" alt="image" width="353" height="219" border="0" /></a>

Once the list is created, go to<strong> Site Settings</strong> then <strong>“Site libraries and lists”</strong>

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML7609667a.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="SNAGHTML7609667a" src="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML7609667a_thumb.png" alt="SNAGHTML7609667a" width="244" height="205" border="0" /></a>

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML760b0e10.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="SNAGHTML760b0e10" src="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML760b0e10_thumb.png" alt="SNAGHTML760b0e10" width="314" height="301" border="0" /></a>

Choose <strong>Customize “MP Catalog”</strong> and click on column <strong>“Title”</strong>

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image4.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb4.png" alt="image" width="308" height="166" border="0" /></a>

Rename this column to <strong>“System Name”</strong>

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image5.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb5.png" alt="image" width="312" height="302" border="0" /></a>

Add the following additional columns:
<ul>
	<li>Categories</li>
	<li>Catalog Item Id</li>
	<li>MP Version</li>
	<li>Public Key</li>
	<li>Version Independent GUID</li>
	<li>Download Link</li>
	<li>Release Date</li>
</ul>
<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image6.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb6.png" alt="image" width="443" height="470" border="0" /></a>

For each of these additional columns, please make sure<strong> “Require that this column contains information”</strong> is set to “No”.

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image7.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb7.png" alt="image" width="484" height="218" border="0" /></a>

<strong><span style="color: #ff0000;">Note:</span></strong> the internal names of these columns would be different than these display names. The script in the SMA runbook will translate these display names to the actual internal names. So it doesn’t matter how you created these columns, as long as the display names are exactly the same as what I listed, it should be OK.
<h3>02. Create a Runbook to Retrieve Microsoft OpsMgr Management Packs Info</h3>
We have all used the “Download Management Packs” function in the OpsMgr console:

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image8.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb8.png" alt="image" width="357" height="308" border="0" /></a>

Michel Kamp has written a <a href="https://michelkamp.wordpress.com/2013/04/21/let-scom-check-for-updated-management-packs/">MP that checks updated management packs</a>. This MP utilize the same web service as what “Download Management Packs” wizard uses. I have used some PowerShell code from Michel’s MP in this runbook. –  Thank you, Michel.

I called this runbook <strong>Get-MSMPCatalog</strong>:

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/Get-MSMPCatalog.zip"><strong>Download Get-MSMPCatalog</strong></a>

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML7630c779.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="SNAGHTML7630c779" src="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML7630c779_thumb.png" alt="SNAGHTML7630c779" width="511" height="440" border="0" /></a>

This runbook will be called by another runbook, and it returns an arraylist as output.
<h3>03. Create a Runbook to Populate the SharePoint List</h3>
I created a second runbook to call the first runbook Get-MSMPCatalog, then workout which MPs are not on the SharePoint List, and add the missing ones. I called the second Runbook <strong>Populate-OnPremMPCatalog:</strong>

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/Populate-OnPremMPCatalog.zip"><strong>Download Populate-OnPremMPCatalog</strong></a>

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML763e3f49.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="SNAGHTML763e3f49" src="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML763e3f49_thumb.png" alt="SNAGHTML763e3f49" width="646" height="558" border="0" /></a>

As you can see, this runbook is expecting 5 parameters:
<ul>
	<li>SharePointSiteURL – URL of the SharePoint site (in my lab, its <a title="http://sharepoint01/sites/requests" href="http://sharepoint01/sites/requests">http://sharepoint01/sites/requests</a>)</li>
	<li>SavedCredentialName – A credential saved in SMA that has access to the SharePoint site. In my lab, I created an AD service account and assigned it as a member in the SharePoint site.</li>
	<li>List Name – The list for the MP catalog. In my lab, it’s “MP Catalog”</li>
	<li>NotifyByEmail – Specify if you’d like an email notification when new MPs have been added to the catalog.</li>
	<li>ContactName – If NotifyByEmail is set to “true”, specify the <a href="http://blog.tyang.org/2014/10/31/simplified-way-send-emails-mobile-push-notifications-sma/">SMAAddressBook</a> connection name for the email notification recipient.</li>
</ul>
<span style="color: #ff0000;"><strong>Note:</strong></span> If you’d like to receive email notifications, you also need to import and configure the <a href="http://blog.tyang.org/2014/10/31/simplified-way-send-emails-mobile-push-notifications-sma/">SendEmail and SendPushNotification modules</a> from my blog. Once the SMTP server connection and the Address book connection are created, please modify line 121 of the Populate-OnPremMPCatalog runbook with the name of your SMTP server’s SMA connection:

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image9.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb9.png" alt="image" width="663" height="267" border="0" /></a>

i.e. My SMTP connection and SMAAddress book connection:

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML766a1bed.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="SNAGHTML766a1bed" src="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML766a1bed_thumb.png" alt="SNAGHTML766a1bed" width="394" height="838" border="0" /></a>

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image10.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb10.png" alt="image" width="395" height="598" border="0" /></a>
<h3>04. Execute Runbook Populate-OnPremMPCatalog</h3>
When executing this runbook, you will need to fill out some parameters as listed above:

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image11.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb11.png" alt="image" width="329" height="298" border="0" /></a>

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image12.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb12.png" alt="image" width="331" height="133" border="0" /></a>

The first run will take a long time (in my lab, over 1 hour), but any subsequent executions shouldn’t take long at all. i.e. I deleted 204 MPs from the SharePoint list, and execute it again:

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image13.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb13.png" alt="image" width="457" height="484" border="0" /></a>

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML76510d6f.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="SNAGHTML76510d6f" src="http://blog.tyang.org/wp-content/uploads/2014/12/SNAGHTML76510d6f_thumb.png" alt="SNAGHTML76510d6f" width="554" height="484" border="0" /></a>

I have also created a schedule to execute this runbook daily. This is to make my catalog in sync with Microsoft’s, and notify me when new MPs are released.

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image14.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb14.png" alt="image" width="531" height="158" border="0" /></a>
<h3>Customizing the MP Catalog SharePoint List</h3>
You may not like the default view of the MP Catalog list. You may want to hide some of the columns. This can be easily done by customising the default view of the list, or creating new views.

<a href="http://blog.tyang.org/wp-content/uploads/2014/12/image15.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="http://blog.tyang.org/wp-content/uploads/2014/12/image_thumb15.png" alt="image" width="584" height="490" border="0" /></a>
<h3>Conclusion</h3>
I’ve always wanted a place where I can simply click on a link to download a particular management pack. I have made this possible by using SMA and SharePoint. The only downside is, only individual management packs are listed. They are not bundled, and no documentations available.

There is also a MP Catalog wiki page on TechNet: <a title="https://social.technet.microsoft.com/wiki/contents/articles/16174.microsoft-management-packs.aspx" href="https://social.technet.microsoft.com/wiki/contents/articles/16174.microsoft-management-packs.aspx">https://social.technet.microsoft.com/wiki/contents/articles/16174.microsoft-management-packs.aspx</a>, it is maintained by Microsoft and few System Center MVPs. You should be able to find all the recent MS management packs from there as well.

I have also managed to populate this catalog on a SharePoint Online (Office 365) site using Azure Automation – a 100% cloud based solution. For the cloud based version, one of the runbooks is completely different due to the differences in SharePoint APIs (SharePoint 2013 vs. SharePoint Online). I will post it in few days.
<h3>Credit</h3>
Thanks for all the System Center MVPs who have provided input and feedback on this topic. You know who you are, much appreciated! <img class="wlEmoticon wlEmoticon-smile" style="border-style: none;" src="http://blog.tyang.org/wp-content/uploads/2014/12/wlEmoticon-smile.png" alt="Smile" />

Lastly, please feel free to contact me if you have anything to add on this topic. I’d love to hear from you.