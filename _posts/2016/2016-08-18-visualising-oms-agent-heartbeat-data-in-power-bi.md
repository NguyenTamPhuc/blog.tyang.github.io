---
id: 5554
title: Visualising OMS Agent Heartbeat Data in Power BI
date: 2016-08-18T22:49:51+10:00
author: Tao Yang
#layout: post
guid: https://blog.tyang.org/?p=5554
permalink: /2016/08/18/visualising-oms-agent-heartbeat-data-in-power-bi/
categories:
  - OMS
  - Power BI
tags:
  - Dashboard
  - OMS
  - Power BI
---

## Introduction

Few days ago, the OMS product team has announced the OMS Agent Heartbeat capability. If you haven’t read about it, you can find the post here: <a title="https://blogs.technet.microsoft.com/msoms/2016/08/16/view-your-agent-health-in-oms-2/" href="https://blogs.technet.microsoft.com/msoms/2016/08/16/view-your-agent-health-in-oms-2/">https://blogs.technet.microsoft.com/msoms/2016/08/16/view-your-agent-health-in-oms-2/</a>. In this post, Nini, the PM for the agent heartbeat feature explained how to create custom views within OMS portal to visualize the agent heartbeat data. Funny that I also started working on something similar around the same time, but instead of creating visual presentations within OMS, I did it Power BI. I managed to create couple of Power BI reports for the OMS agent heartbeat, using both native and custom Power BI Visuals:

**01. Agent Locations Map Report:**

<img src="https://blog.tyang.org/wp-content/uploads/2016/08/OMSAgentLocation.png" width="645" height="372" />

Since the agent heartbeat data contains the geo location of the agent IP address, I’ve created this report to map the physical location the agent on an interactive map.

**02. Agent Statistics Report:**

<img src="https://blog.tyang.org/wp-content/uploads/2016/08/OMSAgentStatistics.png" width="660" height="373" />

This report has several parts, it contains the following parts:

 * A heat map based on the country where the agent is located (Agent Location by Country). The colour highlighting the country changes based on the agent count.
 * An interactive "fish tank" visual. In this visual, each fish represent an OMS agent. the size of the fish presents number of heartbeats generated by the agent. So, the older the agent (fish) is, the more heartbeat will be generated to the OMS workspace (fish tank), and the bigger the fish will become.
 * A Brick chart shows the percentage (this chart contains 100 tiles) of the agent by OS type (Linux vs Windows).
 * A tornado chart shows agent distribution by country. Agent OS type is also separated in different colours.
 * A Pie Chart shows agent distribution by management groups (SCOM attached vs direct attached vs Linux agents)
 * Agent version Donut chart that separates agent counts by agent version numbers (both Windows agents and Linux agents).

The fish visual is called "Enlighten Aquarium", as you can see below, it’s an animated visual.

<img src="https://blog.tyang.org/wp-content/uploads/2016/08/AgentStatistics.gif" />

In this blog post, I will walk through the steps of creating these reports.

## Instructions

### Pre-Requisites

Before we create these reports, you need to make sure:

**01. Power BI account**

You will need to have a Power BI account (either a free or pro account) so OMS can inject data into your Power BI workspace.

**02. Power BI preview feature is enabled in OMS**

At the time of writing this post, the Power BI integration feature in OMS is still under public preview. Therefore if you haven’t done so, you will need to manually enable this feature first. To do so, go to the "Preview Features" tab in the OMS settings page, and enable "Power BI Integration":

<img src="https://blog.tyang.org/wp-content/uploads/2016/08/EnablePowerBI.png" width="486" height="264" />

**03. Connect your OMS workspace to your Power BI workspace.**

Once the Power BI Integration feature is enabled, you need to connect OMS to Power BI. This is achieved by providing the Power BI account credential in the "Accounts" tab of the OMS settings page:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-7.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-7.png" alt="image" width="289" height="282" border="0" /></a>

**04. Setting up Power BI injection schedules**

We need to inject the OMS agent heartbeat data to Power BI. We can just use a simple query: "**Type=Heartbeat**", and set the schedule to run every 15 minutes:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-8.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-8.png" alt="image" width="692" height="291" border="0" /></a>

**05. Wait 15 – 30 minutes**

You will have to wait a while before you can see the data in Power BI.

**06. Download Power BI Custom visual**

Since these reports use number of custom Power BI visuals, you will need to download them to your local computer first, and then import them into the reports when you start creating the reports. To download custom visuals, go to the Power BI Visuals Gallery (<a title="https://app.powerbi.com/visuals/" href="https://app.powerbi.com/visuals/">https://app.powerbi.com/visuals/</a>) and download the following visuals:

 * Brick Chart
 * Hierarchy Slicer
 * Donut Chart GMO
 * Timeline
 * Tornado Chart
 * Enlighten Aquarium


### Create Reports

To start creating the report, firstly logon to Power BI using the account you’ve used to make the connection in OMS, and then find the Dataset you have specified. in this post, I’ve created a dataset called "OMS – Agent Heartbeat". By clicking on the dataset, you will be presented to an empty report:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-9.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-9.png" alt="image" width="558" height="334" border="0" /></a>

You will then need to import the custom visuals – by clicking on the "…" icon under Visualizations, and select "Import a custom visual"

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-10.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-10.png" alt="image" width="244" height="199" border="0" /></a>

You can only import one at a time, so please repeat this process and import all the custom visuals I have listed above.

#### Creating Agent Location Report

For the Agent location report, we will add 3 visuals:

 * Hierarchy Slicer – for filtering IP addresses and computer names
 * Map – for pinpointing the agent location
 * Timeline – for filtering the time windows

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-11.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-11.png" alt="image" width="182" height="155" border="0" /></a>

**Agent Filter (Hierarchy Slicer)**

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-12.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-12.png" alt="image" width="136" height="302" border="0" /></a>

Add a Hierarchy slicer and place on the left side of the page, then drag the ComputerIP and Computer fields from to the "Fields" section, please make sure you place ComputerIP on top of Computer:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-13.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-13.png" alt="image" width="134" height="244" border="0" /></a>

it’s also a good idea to turn off single selection for the hierarchy slicer so you can select multiple items:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-14.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-14.png" alt="image" width="176" height="244" border="0" /></a>

**Agent Location Map**

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-15.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-15.png" alt="image" width="404" height="216" border="0" /></a>

Add the Map visual to the report, configure it as listed below:

 * Location – RemoteIPCountry
 * Legend – Computer
 * Latitude – Average of Remote IPLatitude
 * Longitude – Average of RemoteIPLongitude
 * Size – Count of Computer (Distinct)

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-16.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-16.png" alt="image" width="140" height="244" border="0" /></a>

**Note:** since the latitude and longitude shouldn’t change between different records for the same computer as long as the IP doesn’t change, so it doesn’t matter if you use average, or maximum or minimum, the result of each calculation should be the same.

**Time Slicer (Timeline)**

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-17.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-17.png" alt="image" width="534" height="77" border="0" /></a>

Add a timeline slicer to the bottom of the report page, configure it to use the TimeGenerated field:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-18.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-18.png" alt="image" width="180" height="244" border="0" /></a>

To same some space on the report page, you may also turn off the labels for the timeline slicer:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-19.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-19.png" alt="image" width="123" height="244" border="0" /></a>

Lastly, add a text box on the top of the report page, give it a title, also if you want to, assign each visual a title by highlighting the visual, then click on Format icon, and update the title field:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-20.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-20.png" alt="image" width="134" height="308" border="0" /></a>

To use this report, you can make your selections in the hierarchy slicer and the timeline slicer. The map will be automatically updated.

**Create Agent Statistic Report**

For the second report, you can create a new page of the existing report, or create a brand new report based on the same dataset. We will use the following visuals in this report:

 * Filled Map
 * Aquarium
 * Brick Chart
 * Tornado Chart
 * Pie Chart
 * DonutChartGMO

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-21.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-21.png" alt="image" width="243" height="141" border="0" /></a>

**Agent Location By Country (Filled Map)**

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-22.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-22.png" alt="image" width="355" height="220" border="0" /></a>

Configure the Filled Map visual as shown below:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-23.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-23.png" alt="image" width="256" height="427" border="0" /></a>

**OMS Agent By Heartbeat Count (Aquarium)**

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-24.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-24.png" alt="image" width="329" height="202" border="0" /></a>

Configure the Aquarium visual as shown below:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-25.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-25.png" alt="image" width="272" height="295" border="0" /></a>

**Agent OS Type (Brick Chart)**

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-26.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-26.png" alt="image" width="233" height="244" border="0" /></a>

Configure the Brick Chart visual as shown below:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-27.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-27.png" alt="image" width="259" height="308" border="0" /></a>

**Agent Distribution By Country (Tornado Chart)**

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-28.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-28.png" alt="image" width="241" height="244" border="0" /></a>

Configure the Tornado Chart as shown below:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-29.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-29.png" alt="image" width="275" height="360" border="0" /></a>

**Agent Distribution By Management Groups (Pie Chart)**

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-30.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-30.png" alt="image" width="235" height="244" border="0" /></a>

Configure the Pie Chart as shown below:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-31.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-31.png" alt="image" width="236" height="315" border="0" /></a>

**Agent Version (DonutChartGMO)**

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-32.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-32.png" alt="image" width="244" height="163" border="0" /></a>

Configure the DonutChartGMO visual as shown below:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-33.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-33.png" alt="image" width="203" height="244" border="0" /></a>

and change the Primary Measure under Legend to "Value" / "Percentage" / "Both", whichever you prefer:

<a href="https://blog.tyang.org/wp-content/uploads/2016/08/image-34.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border: 0px;" title="image" src="https://blog.tyang.org/wp-content/uploads/2016/08/image_thumb-34.png" alt="image" width="114" height="244" border="0" /></a>

Most of the visuals used by this report are interactive. i.e. if I click on a section in the Agent Version DonutChartGMO visual, other visuals will be automatically updated to reflect the selection I made in the DonutChartGMO visual.

Once you’ve configured all the visuals, please make sure you save your report.

## Conclusion

There are many things you can do with the Power BI reports you’ve just created. i.e. you can share it with other people, ping individual visuals or entire report to a dashboard, or create an Iframe link and embed the report to 3rd party systems that support IFrame (i.e. SharePoint sites). We are not going to get into details of how to consume these reports today.

Please note that during my testing, the RemoteIPLatitude and RemoteIPLongitude data from the heartbeat events are not very accurate for the computers in my lab. I’m based in Melbourne, Australia but the map coordinates pinged to a location in Sydney, which is over 1000km away from me.

Please also be aware that for SCOM attached agents, each time when the agent sends heartbeat, it will send 2 heartbeats via different channels. This behaviour is by design – my good friend and fellow CDM MVP Stanislav Zhelyazkov(<a href="https://twitter.com/StanZhelyazkov">@StanZhelyazkov</a>) has explained this in his blog post: <a title="https://cloudadministrator.wordpress.com/2016/08/17/double-heartbeat-events-in-oms-log-analytics/" href="https://cloudadministrator.wordpress.com/2016/08/17/double-heartbeat-events-in-oms-log-analytics/">https://cloudadministrator.wordpress.com/2016/08/17/double-heartbeat-events-in-oms-log-analytics/</a>

This is all I have to share for today. until next time, have fun with OMS and Power BI!