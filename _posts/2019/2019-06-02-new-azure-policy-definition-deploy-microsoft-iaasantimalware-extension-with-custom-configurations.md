---
id: 7086
title: 'New Azure Policy Definition: Deploy Microsoft IaaSAntimalware extension with custom configurations'
date: 2019-06-02T21:22:56+10:00
author: Tao Yang
#layout: post
guid: https://blog.tyang.org/?p=7086
permalink: /2019/06/02/new-azure-policy-definition-deploy-microsoft-iaasantimalware-extension-with-custom-configurations/
categories:
  - Azure
tags:
  - Azure
  - Azure Policy
---
Microsoft provides a built-in Azure Policy definition for deploying Windows Defender VM Extension. The name of this policy definition is *Deploy default Microsoft IaaSAntimalware extension for Windows Server* (id: /providers/Microsoft.Authorization/policyDefinitions/2835b622-407b-4114-9198-6f7064cbe0dc)

This policy definition has many limitations:

1. It does not support Windows 10 VMs
2. It does not support custom VM images
3. It does not support customization of the Windows Defender configurations (i.e. scan exclusions, etc.)

I had a requirement to automatically deploy this VM extension with customised configuration. So I have re-written this policy, addressed all the limitations listed above. You can find it at my Azure Policy GitHub repo: <a href="https://github.com/tyconsulting/azurepolicy/tree/master/policy-definitions/deploy-windows-defender-vm-extension-custom-config">https://github.com/tyconsulting/azurepolicy/tree/master/policy-definitions/deploy-windows-defender-vm-extension-custom-config</a>. With this definition, you can customize your configuration using the following parameters:

<a href="https://blog.tyang.org/wp-content/uploads/2019/06/image-2.png"><img width="542" height="506" title="image" style="display: inline; background-image: none;" alt="image" src="https://blog.tyang.org/wp-content/uploads/2019/06/image_thumb-2.png" border="0"></a>